version: '3'

services:
  postgres:
    image: postgres:11
    environment:
      - POSTGRES_DB=${POSTGRES_DB}
      - POSTGRES_USER=${POSTGRES_USER}
      - POSTGRES_PASSWORD=${POSTGRES_PW}
    expose:
       - '5432'
    networks:
       - backend

  cuizinart:
     build: ./cuizinart
     depends_on:
       - postgres
     env_file:
       - .env
     ports:
       - '5000:5000'
     networks:
       - backend
     volumes:
       - /tuna1/scratch/mgauch/data/cuizinart:/tuna1/scratch/mgauch/data/cuizinart

  pyspark:
    build: ./cuizinart_pyspark
    expose:
      - '5001'
    networks:
      - backend
    volumes:
      - /tuna1/scratch/mgauch/data/cuizinart:/tuna1/scratch/mgauch/data/cuizinart
      - /tuna1/scratch/mgauch/data/output:/tuna1/scratch/mgauch/data/output

networks:
  backend:
    driver: bridge

